{
   "settings":{
      "index":{
         "codec":"best_compression",
         "mapping.total_fields.limit":"2000",
         "number_of_shards":"{{ .Values.elasticsearch.index_shards }}",
         "number_of_replicas":"{{ .Values.elasticsearch.index_replicas }}",
         "refresh_interval":"5s"
      }
   },
   "mappings":{
      "_source":{
         "enabled":true
      },
      "dynamic_templates":[
         {
            "commonLabels.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"labels.*"
            }
         },
         {
            "labels.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"labels.*"
            }
         },
         {
            "kubernetes.labels.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"kubernetes.labels.*"
            }
         },
         {
            "kubernetes.annotations.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"kubernetes.annotations.*"
            }
         },
         {
            "host.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"host.*"
            }
         }
      ],
      "properties":{
         "@timestamp":{
            "type":"date"
         },
         "container":{
            "properties":{
               "id":{
                  "type":"keyword",
                  "ignore_above":1024
               },
               "image":{
                  "properties":{
                     "name":{
                        "type":"keyword",
                        "ignore_above":1024
                     }
                  }
               },
               "runtime":{
                  "type":"keyword",
                  "ignore_above":1024
               }
            }
         },
         "message":{
            "type":"text"
         },
         "nginx":{
            "properties":{
               "access":{
                  "properties":{
                     "agent":{
                        "type":"keyword"
                     },
                     "body_sent":{
                        "properties":{
                          "bytes":{
                             "type":"long"
                           }
                        }   
                     },
                     "http_version":{
                        "type":"keyword"
                     },
                     "method":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "proxy":{
                        "properties":{
                           "upstream_name":{
                              "type":"keyword",
                              "ignore_above":256
                           }
                        }
                     },
                     "referrer":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "remote_ip":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "request":{
                        "properties":{
                           "length":{
                              "type":"long"
                           },
                           "time":{
                              "type":"double"
                           }
                        }
                     },
                     "request_id":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "response_code":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "upstream":{
                        "properties":{
                           "response_length":{
                              "type":"keyword"
                           },
                           "response_status":{
                              "type":"keyword"
                           },
                           "response_time":{
                              "type":"keyword"
                           }
                        }
                     },
                     "upstream_addr":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "url":{
                        "type":"keyword",
                        "ignore_above":256
                     },
                     "user_name":{
                        "type":"keyword",
                        "ignore_above":256
                     }
                  }
               }
            }
         }
      }
   },
   "index_patterns":[
      "nginx-ingress-access-log-*"
   ]
}